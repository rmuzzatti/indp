---
title: "indp"
output: html_document
date: "2025-02-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(patchclampplotteR)
library(dplyr)
```

Cell Characteristics (all)
```{r}
cell_characteristics <- import_cell_characteristics_df("data/Cell-Characteristics.csv")

cell_characteristics
```

Raw evoked current data (RM)
```{r}
raw_eEPSC_df <- read.csv("data/rraw-eEPSC.csv")
```

To automatically append new data onto your existing sheet and save as new csv to data subfolder
```{r eval=FALSE}
add_new_cells(
  new_raw_data_csv = "data/rraw-eEPSC.csv",
  cell_characteristics_csv = "data/Cell-Characteristics.csv",
  old_raw_data_csv = "data/rraw-eEPSC.csv",
  data_type = "eEPSC",
  write_new_csv = "yes",
  new_file_name = "data/rraw-eEPSC.csv",
  decimal_places = 2
)
```

how many naive cells
```{r}
raw_eEPSC_df %>%
  filter(category == 1) %>%
  filter(treatment == "Control") %>%
  filter(time == 0) %>%
 group_by(treatment) %>%
  count(sex) %>%
  arrange(treatment, sex)
```
how many cold cells
```{r}
raw_eEPSC_df %>%
  filter(category == 2) %>%
  filter(treatment == "Control") %>%
  filter(time == 0) %>%
 group_by(treatment) %>%
  count(sex) %>%
  arrange(treatment, sex)
```

```{r}
my_theme_colours <- data.frame(
  category = c(1, 2),
    treatment = c("Control", "Control"),
  display_names = c("Naive", "Cold"),
  colours = c("#eb647e", "#005b96"),
  very_pale_colours = c("#f19cac", "#6497b1")
)
```


```{r}
raw_eEPSC_df <- make_normalized_EPSC_data(
  filename = "data/rraw-eEPSC.csv",
  current_type = "eEPSC",
  min_time_value = 0,
  max_time_value = 25,
  interval_length = 5,
  baseline_length = 5,
  negative_transform_currents = "yes"
)
```

Naive Plots:
```{r}
raw_eEPSC_control_plots <- plot_raw_current_data(
  data = raw_eEPSC_df %>% filter(sex == "Female"),
  plot_treatment = "Control",
  plot_category = 1,
  current_type = "eEPSC",
  y_variable = "P1",
  pruned = "no",
  hormone_added = "HFS",
  hormone_or_HFS_start_time = 5,
  theme_options = sample_theme_options,
  treatment_colour_theme = my_theme_colours
)

raw_eEPSC_control_plots

```
Cold Plots:
```{r}
raw_eEPSC_cold_plots <- plot_raw_current_data(
  data = raw_eEPSC_df %>% filter(sex == "Female"),
  plot_treatment = "Control",
  plot_category = 2,
  current_type = "eEPSC",
  y_variable = "P1",
  pruned = "no",
  hormone_added = "HFS",
  hormone_or_HFS_start_time = 5,
  theme_options = sample_theme_options,
  treatment_colour_theme = my_theme_colours
)

raw_eEPSC_cold_plots
```
Prune FEMALE Data:
```{r}
pruned_female_eEPSC_df <- make_pruned_EPSC_data(
  data = raw_eEPSC_df %>% filter(sex == "Female"),
  current_type = "eEPSC",
  min_time_value = 0,
  max_time_value = 25,
  baseline_length = 5,
  interval_length = 1
)

pruned_female_eEPSC_df$individual_cells
```

Plot Pruned Data of Naive:
```{r}
pruned_female_eEPSC_df_control_plots <- plot_raw_current_data(
  data = pruned_female_eEPSC_df$individual_cells,
  plot_treatment = "Control",
  plot_category = 1,
  current_type = "eEPSC",
  y_variable = "mean_P1",
  pruned = "yes",
  hormone_added = "HFS",
  hormone_or_HFS_start_time = 5,
  theme_options = sample_theme_options,
  treatment_colour_theme = my_theme_colours
)

pruned_female_eEPSC_df_control_plots
```
CELL GROUPS:
```{r eval=FALSE}
naive_female_long <- pruned_female_eEPSC_df$individual_cells %>% filter(letter %in% c("AA","AC", "AD", "AE", "AF", "AG", "AH", "AI", "AJ", "AK", "AL", "AM", "AN", "AO", "AP", "AQ", "AR", "AS", "AT", "AU", "AX", "AY", "CF", "CG", "CH"))

cold_female_long <- pruned_female_eEPSC_df$individual_cells %>% filter(letter %in% c("RM1", "RM2", "RM3", "RM4", "RM5", "RM6", "RM7", "RM8", "RM9"))

cold_female_short <- pruned_female_eEPSC_df$individual_cells %>% filter(letter %in% c("RM100", "RM101", "RM102", "RM103", "RM104"))
```

Plot Pruned Data of Cold:
```{r}
pruned_female_eEPSC_df_cold_plots <- plot_raw_current_data(
  data = pruned_female_eEPSC_df$individual_cells,
  plot_treatment = "Control",
  plot_category = 2,
  current_type = "eEPSC",
  y_variable = "mean_P1",
  pruned = "yes",
  hormone_added = "HFS",
  hormone_or_HFS_start_time = 5,
  theme_options = sample_theme_options,
  treatment_colour_theme = my_theme_colours
)

pruned_female_eEPSC_df_cold_plots
```

FEMALE summary eEPSC data:
```{r}
summary_female_eEPSC_df <- make_summary_EPSC_data(
  data = raw_eEPSC_df %>% filter(sex == "Female"),
  current_type = "eEPSC",
  save_output_as_RDS = "no",
  baseline_interval = "t0to5",
  ending_interval = "t20to25"
)
summary_female_eEPSC_df
```

t-test for naive FEMALE:
```{r}
t_test_female_naive <-perform_t_tests_for_summary_plot(
  data = summary_female_eEPSC_df$summary_data,
  test_category = 1,
  include_all_treatments = "no",
  list_of_treatments = c("Control"),
  current_type = "eEPSC",
  parameter = "amplitude",
  baseline_interval = "t0to5",
  interval_length = 5,
  treatment_colour_theme = my_theme_colours,
  save_output_as_RDS = "no"
)

t_test_female_naive
```

t-test for cold (full cells only) FEMALE
```{r}
t_test_female_cold <- perform_t_tests_for_summary_plot(
  data = summary_female_eEPSC_df$summary_data %>% filter(letter %in% c("RM1", "RM2", "RM3", "RM4", "RM5", "RM6", "RM7", "RM8", "RM9")),
  test_category = 2,
  include_all_treatments = "yes",
  list_of_treatments = NULL,
  current_type = "eEPSC",
  parameter = "amplitude",
  baseline_interval = "t0to5",
  interval_length = 5,
  treatment_colour_theme = my_theme_colours,
  save_output_as_RDS = "no"
)
t_test_female_cold
```

Naive FEMALE Summary:
```{r}
plot_summary_current_data(
  data = pruned_female_eEPSC_df$all_cells ,
  plot_category = 1,
  plot_treatment = "Control",
  current_type = "eEPSC",
  y_variable = "amplitude",
  hormone_added = "HFS",
  hormone_or_HFS_start_time = 5,
  included_sexes = "both",
  include_representative_trace = "no",
  representative_trace_filename = import_ext_data("Control-trace.png"),
  y_axis_limit = 225,
  signif_stars = "no",
  t_test_df = t_test_female_naive,
  large_axis_text = "no",
  shade_intervals = "no",
  treatment_colour_theme = my_theme_colours,
  theme_options = sample_theme_options
)

```
Cold Summary FEMALE:
currrently plotting all 14 cells but the t-test is only for the full cells
```{r}
plot_summary_current_data(
  data = pruned_female_eEPSC_df$all_cells ,
  plot_category = 2,
  plot_treatment = "Control",
  current_type = "eEPSC",
  y_variable = "amplitude",
  hormone_added = "HFS",
  hormone_or_HFS_start_time = 5,
  included_sexes = "both",
  include_representative_trace = "no",
  representative_trace_filename = import_ext_data("Control-trace.png"),
  y_axis_limit = 225,
  signif_stars = "yes",
  t_test_df = t_test_female_cold,
  large_axis_text = "no",
  shade_intervals = "no",
  treatment_colour_theme = my_theme_colours,
  theme_options = sample_theme_options
)

```

make PPR dataset:
```{r}
PPR_df <- make_PPR_data(
  data = raw_eEPSC_df,
  include_all_treatments = "no",
  list_of_treatments = c("Control"),
  PPR_min = 0,
  PPR_max = 5,
  baseline_interval = "t0to5",
  post_hormone_interval = "t20to25",
  treatment_colour_theme = my_theme_colours
)
PPR_df
```

plot PPR data for naive:
```{r}
plot_PPR_data_single_treatment(
  data = PPR_df,
  plot_treatment = "Control",
  plot_category = 1,
  baseline_label = "Baseline",
  post_hormone_label = "HFS",
  test_type = "t.test",
  large_axis_text = "no",
  treatment_colour_theme = my_theme_colours,
  theme_options = sample_theme_options,
  save_plot_png = "no"
)
```
plot PPR data for cold:
```{r}
plot_PPR_data_single_treatment(
  data = PPR_df,
  plot_treatment = "Control",
  plot_category = 2,
  baseline_label = "Baseline",
  post_hormone_label = "HFS",
  test_type = "t.test",
  large_axis_text = "no",
  treatment_colour_theme = my_theme_colours,
  theme_options = sample_theme_options,
  save_plot_png = "no"
)
```

Naive baseline:
```{r}
plot_baseline_data(
  data = summary_eEPSC_df$summary_data,
  current_type = "eEPSC",
  plot_category = 1,
  y_variable = "raw_amplitude",
  include_all_treatments = "yes",
  list_of_treatments = NULL,
  baseline_interval = "t0to5",
  large_axis_text = "no",
  plot_width = 8,
  treatment_colour_theme = my_theme_colours,
  theme_options = sample_theme_options,
  save_plot_png = "no"
)
```
Cold baseline:
```{r}
plot_baseline_data(
  data = summary_eEPSC_df$summary_data,
  current_type = "eEPSC",
  plot_category = 2,
  y_variable = "raw_amplitude",
 include_all_treatments = "no",
  list_of_treatments = c("Control"),
  baseline_interval = "t0to5",
  large_axis_text = "no",
  plot_width = 8,
  treatment_colour_theme = my_theme_colours,
  theme_options = sample_theme_options,
  save_plot_png = "no"
)
```
TO DO:
Plot a representative recording trace showing spontaneous currents (https://christelinda-laureijs.github.io/patchclampplotteR/index.html)
Plot action potential trace
AP frequency (https://christelinda-laureijs.github.io/patchclampplotteR/articles/action-potential-analysis.html?q=action#count)